<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ReliableStore — Login</title>
  <style>
    body { font-family: system-ui, -apple-system, Roboto, "Segoe UI", Arial; max-width:720px; margin:40px auto; padding:0 16px; }
    input { display:block; width:100%; padding:10px; margin:8px 0; box-sizing:border-box }
    button { padding:10px 16px; margin:6px 6px 6px 0; }
    .note { color:#555; font-size:0.95rem }
  </style>
</head>
<body>
  <h1>ReliableStore — Account</h1>

  <section>
    <h2>Create account</h2>
    <input id="signup_email" type="email" placeholder="Email" />
    <input id="signup_password" type="password" placeholder="Password (min 6 chars)" />
    <button id="btn_signup">Sign up</button>
    <p class="note">After signing up you will receive a verification email. Please verify before logging in.</p>
  </section>

  <hr/>

  <section>
    <h2>Sign in</h2>
    <input id="signin_email" type="email" placeholder="Email" />
    <input id="signin_password" type="password" placeholder="Password" />
    <button id="btn_signin">Sign in</button>
    <button id="btn_signin_magic">Send magic link (email)</button>
  </section>

  <p>
    <a href="/forgot-password.html">Forgot password?</a> ·
    <a href="/profile.html">Go to profile (protected)</a>
  </p>

  <div id="status" style="margin-top:18px;color: #1a1a1a"></div>

  <script type="module">
    import { supabase } from '/assets/js/supabase_client.js'

    const status = msg => { document.getElementById('status').innerText = msg || '' }

    // Sign up
    document.getElementById('btn_signup').addEventListener('click', async () => {
      status('Signing up...')
      const email = document.getElementById('signup_email').value
      const password = document.getElementById('signup_password').value
      if (!email || !password) return status('Enter email and password.')
      const { data, error } = await supabase.auth.signUp({ email, password }, { redirectTo: `${window.location.origin}/login.html` })
      if (error) {
        status('Signup error: ' + error.message)
      } else {
        status('Signup successful — check your email for verification link.')
      }
    })

    // Sign in with password
    document.getElementById('btn_signin').addEventListener('click', async () => {
      status('Signing in...')
      const email = document.getElementById('signin_email').value
      const password = document.getElementById('signin_password').value
      if (!email || !password) return status('Enter email and password.')
      const { data, error } = await supabase.auth.signInWithPassword({ email, password })
      if (error) {
        status('Login error: ' + error.message)
      } else {
        status('Logged in successfully.')
        // redirect to profile/dashboard
        window.location.href = '/profile.html'
      }
    })

    // Magic link
    document.getElementById('btn_signin_magic').addEventListener('click', async () => {
      status('Sending magic link...')
      const email = document.getElementById('signin_email').value
      if (!email) return status('Enter email first.')
      const { data, error } = await supabase.auth.signInWithOtp({ email })
      if (error) status('Error sending magic link: ' + error.message)
      else status('Magic link sent. Check your email.')
    })

    // Show signed in user in console and handle redirect after verify
    supabase.auth.onAuthStateChange((event, session) => {
      console.log('auth event', event, session)
    })
  </script>
</body>
</html>
